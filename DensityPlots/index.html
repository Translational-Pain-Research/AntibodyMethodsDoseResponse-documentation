<!DOCTYPE html>
<html lang="en"><head><meta charset="UTF-8"/><meta name="viewport" content="width=device-width, initial-scale=1.0"/><title>Density plots for OneDimGrid · AntibodyMethodsDoseResponse</title><meta name="title" content="Density plots for OneDimGrid · AntibodyMethodsDoseResponse"/><meta property="og:title" content="Density plots for OneDimGrid · AntibodyMethodsDoseResponse"/><meta property="twitter:title" content="Density plots for OneDimGrid · AntibodyMethodsDoseResponse"/><meta name="description" content="Documentation for AntibodyMethodsDoseResponse."/><meta property="og:description" content="Documentation for AntibodyMethodsDoseResponse."/><meta property="twitter:description" content="Documentation for AntibodyMethodsDoseResponse."/><script data-outdated-warner src="../assets/warner.js"></script><link href="https://cdnjs.cloudflare.com/ajax/libs/lato-font/3.0.0/css/lato-font.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/juliamono/0.050/juliamono.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/css/fontawesome.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/css/solid.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/css/brands.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/KaTeX/0.16.8/katex.min.css" rel="stylesheet" type="text/css"/><script>documenterBaseURL=".."</script><script src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.6/require.min.js" data-main="../assets/documenter.js"></script><script src="../search_index.js"></script><script src="../siteinfo.js"></script><script src="../../versions.js"></script><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../assets/themes/catppuccin-mocha.css" data-theme-name="catppuccin-mocha"/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../assets/themes/catppuccin-macchiato.css" data-theme-name="catppuccin-macchiato"/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../assets/themes/catppuccin-frappe.css" data-theme-name="catppuccin-frappe"/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../assets/themes/catppuccin-latte.css" data-theme-name="catppuccin-latte"/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../assets/themes/documenter-dark.css" data-theme-name="documenter-dark" data-theme-primary-dark/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../assets/themes/documenter-light.css" data-theme-name="documenter-light" data-theme-primary/><script src="../assets/themeswap.js"></script></head><body><div id="documenter"><nav class="docs-sidebar"><a class="docs-logo" href="../"><img src="../assets/logo.svg" alt="AntibodyMethodsDoseResponse logo"/></a><div class="docs-package-name"><span class="docs-autofit"><a href="../">AntibodyMethodsDoseResponse</a></span></div><button class="docs-search-query input is-rounded is-small is-clickable my-2 mx-auto py-1 px-2" id="documenter-search-query">Search docs (Ctrl + /)</button><ul class="docs-menu"><li><a class="tocitem" href="../">Introduction</a></li><li><a class="tocitem" href="../QuickStart/">Quick start</a></li><li><span class="tocitem">Detailed explanations</span><ul><li><a class="tocitem" href="../MeasurementData/">Measurement data</a></li><li><a class="tocitem" href="../Models/">Models</a></li><li><a class="tocitem" href="../ResultsAndSimulations/">Results and simulations</a></li><li class="is-active"><a class="tocitem" href>Density plots for <code>OneDimGrid</code></a><ul class="internal"><li><a class="tocitem" href="#The-DensityPlot-recipe"><span>The <code>DensityPlot</code> recipe</span></a></li><li><a class="tocitem" href="#log_volume_normalization"><span>Background: log-volume normalization</span></a></li></ul></li><li><a class="tocitem" href="../Fitting/">Fitting</a></li><li><a class="tocitem" href="../Uncertainty/">Uncertainty estimation</a></li></ul></li><li><span class="tocitem">API</span><ul><li><a class="tocitem" href="../API/">AntibodyMethodsDoseResponse</a></li><li><a class="tocitem" href="../API_Convenience/">AntibodyMethodsDoseResponseConvenience</a></li></ul></li></ul><div class="docs-version-selector field has-addons"><div class="control"><span class="docs-label button is-static is-size-7">Version</span></div><div class="docs-selector control is-expanded"><div class="select is-fullwidth is-size-7"><select id="documenter-version-selector"></select></div></div></div></nav><div class="docs-main"><header class="docs-navbar"><a class="docs-sidebar-button docs-navbar-link fa-solid fa-bars is-hidden-desktop" id="documenter-sidebar-button" href="#"></a><nav class="breadcrumb"><ul class="is-hidden-mobile"><li><a class="is-disabled">Detailed explanations</a></li><li class="is-active"><a href>Density plots for <code>OneDimGrid</code></a></li></ul><ul class="is-hidden-tablet"><li class="is-active"><a href>Density plots for <code>OneDimGrid</code></a></li></ul></nav><div class="docs-right"><a class="docs-navbar-link" href="https://github.com/AntibodyPackages/AntibodyMethodsDoseResponse.jl" title="View the repository on GitHub"><span class="docs-icon fa-brands"></span><span class="docs-label is-hidden-touch">GitHub</span></a><a class="docs-navbar-link" href="https://github.com/AntibodyPackages/AntibodyMethodsDoseResponse.jl/blob/main/docs/src/DensityPlots.md" title="Edit source on GitHub"><span class="docs-icon fa-solid"></span></a><a class="docs-settings-button docs-navbar-link fa-solid fa-gear" id="documenter-settings-button" href="#" title="Settings"></a><a class="docs-article-toggle-button fa-solid fa-chevron-up" id="documenter-article-toggle-button" href="javascript:;" title="Collapse all docstrings"></a></div></header><article class="content" id="documenter-page"><h1 id="Density-plots-for-OneDimGrid"><a class="docs-heading-anchor" href="#Density-plots-for-OneDimGrid">Density plots for <code>OneDimGrid</code></a><a id="Density-plots-for-OneDimGrid-1"></a><a class="docs-heading-anchor-permalink" href="#Density-plots-for-OneDimGrid" title="Permalink"></a></h1><p>Consider the following density:</p><pre><code class="language-julia hljs">using AntibodyMethodsDoseResponseConvenience
using Distributions

p(x) = pdf(Normal(1e-5,3e-6),x)
plot(p, xaxis = :log, xlims = [1e-10,1e-2], fill = 0, label = &quot;density&quot;)</code></pre><img src="59773d64.svg" alt="Example block output"/><p>In the previous tutorials it was explained how this density can be approximated with a <code>OneDimGrid</code> and how the <code>OneDimGrid</code> can be plotted:</p><pre><code class="language-julia hljs">using AdaptiveDensityApproximationRecipes
grid = create_grid(LogRange(1e-10,1e-2,50))
approximate_density!(grid, p, volume_normalization = true)
plot(grid, xaxis = :log)</code></pre><img src="2f76d9e8.svg" alt="Example block output"/><p>While the grid-plot can be helpful, it can also be distracting for an assessment of the density approximation. </p><h2 id="The-DensityPlot-recipe"><a class="docs-heading-anchor" href="#The-DensityPlot-recipe">The <code>DensityPlot</code> recipe</a><a id="The-DensityPlot-recipe-1"></a><a class="docs-heading-anchor-permalink" href="#The-DensityPlot-recipe" title="Permalink"></a></h2><p>The <a href="https://github.com/AntibodyPackages/AntibodyMethodsDoseResponseRecipes.jl"><code>AntibodyMethodsDoseResponseRecipes.jl</code></a> package offers a plotting recipe to plot the density that a <code>OneDimGrid</code> approximates (this package is automatically imported by <a href="../API_Convenience/#api_convenience"><code>AntibodyMethodsDoseResponseConvenience.jl</code></a>):</p><pre><code class="language-julia hljs">plot(DensityPlot(grid), xaxis = :log, fill = 0, volume_normalization = :linear, label = &quot;:linear&quot;)</code></pre><img src="c8a02893.svg" alt="Example block output"/><p>Observe that the <span>$y$</span>-axis now has the same scale as in the density plot.</p><div class="admonition is-info"><header class="admonition-header">volume_normalization</header><div class="admonition-body"><p>The <code>OneDimGrid</code> weights correspond to the number of epitopes <span>$\lambda_j$</span> with <span>$K_\tau$</span> in a given interval <span>$I_j$</span>, not to the density value <span>$g_j = \frac{\lambda_j}{\text{length}(I_j)}$</span>. Thus it is necessary to divide the weights by the interval lengths (<code>volume_normalization = :linear</code>) to obtain the true density shape. However, using the visual volumes of the logarithmic scale (<code>volume_normalization = :log</code>) represents the contribution of peaks to the dose-response curve more accurately (see <a href="#log_volume_normalization">Background: log-volume normalization</a>). Hence, it is the default normalization despite not being the &quot;true&quot; density plot.</p></div></div><pre><code class="language-julia hljs">plot(DensityPlot(grid), xaxis = :log, volume_normalization = :none,
	fill = 0, fillapha = 0.5, label = &quot;:none = grid plot&quot;, legend = :topleft)

plot!(DensityPlot(grid), volume_normalization = :log, fill = 0, fillalpha = 0.5, label = &quot;:log&quot;)</code></pre><img src="80bcce52.svg" alt="Example block output"/><p>With <code>DensityAnnotations</code> it is possible to display the total number of epitopes within selected annotation bins, on top of an already existing density plot:</p><pre><code class="language-julia hljs">plot(DensityPlot(grid), label = &quot;grid&quot;)
plot!(DensityAnnotations(grid), xaxis = :log,
	volume_normalization = :log,
	annotation_bins = [[1e-10,1e-6], [1e-6,1e-4],[1e-4,1e-2]],
	annotation_size = 10,
	annotation_offset = [0.2,0.1,0.2],
	hover_points = false,
	annotation_color = :black
	)</code></pre><img src="908b4c20.svg" alt="Example block output"/><h3 id="Keywords-and-default-arguments"><a class="docs-heading-anchor" href="#Keywords-and-default-arguments">Keywords and default arguments</a><a id="Keywords-and-default-arguments-1"></a><a class="docs-heading-anchor-permalink" href="#Keywords-and-default-arguments" title="Permalink"></a></h3><ul><li><code>volume_normalization = :log</code>: This keyword is needed to estimate the height of the annotation markers. Hence it should match the choice for the density plot.</li><li><code>annotation_bins = []</code>: The selected bins as vector of vectors. The bins are selected based on the <span>$K_\tau$</span> value, not based on the grid interval index. </li><li><code>annotation_size = 10</code>: Font size for the annotation labels (that show the number of epitopes within the bin).</li><li><code>annotation_offset = 0.05</code>: Offset of the annotation labels from the top of the plot (as fraction of the plot height). When a single <code>value</code> is provided, the offsets alternate between <code>0</code> and the provided <code>value</code>. Alternatively, the offsets can be provided independently for each annotation bin, by providing a length-matched array of offsets.</li><li><code>hover_points = false</code>: Only recommended if the <a href="https://docs.juliaplots.org/latest/backends/">Plotly/PlotlyJs backend</a> is used. If <code>true</code>, scatter points with the annotation label as tooltip are added, as the <a href="https://docs.juliaplots.org/latest/backends/">Plotly/PlotlyJs backend</a> handles annotations differently.</li><li><code>annotation_color = :black</code>: The color for the annotation labels and bin lines.</li></ul><div class="admonition is-info"><header class="admonition-header">Number of epitopes</header><div class="admonition-body"><p>The &quot;number of epitopes&quot; is calculated in the dimension/unit that the response values are provided in. If the response value is the total number of bound antibody-epitope complexes, the calculated &quot;number of epitopes&quot; is indeed the number of epitopes. If the responses are measured as quantity that is only proportional to the number of bound complexes, the &quot;number of epitopes&quot; is only proportional to the actual number of epitopes, with the same proportionality constant.</p></div></div><h2 id="log_volume_normalization"><a class="docs-heading-anchor" href="#log_volume_normalization">Background: log-volume normalization</a><a id="log_volume_normalization-1"></a><a class="docs-heading-anchor-permalink" href="#log_volume_normalization" title="Permalink"></a></h2><div class="admonition is-warning"><header class="admonition-header">log-volume and standard volume</header><div class="admonition-body"><p><strong>log-volume</strong> means the visual volume (visual interval length) in a plot with logarithmic scale, <strong>not the logarithm of the volume!</strong>. It corresponds to <code>volume_normalization = :log</code>. <strong>Standard volume</strong> is the true volume (interval length), corresponding to <code>volume_normalization = :linear</code>.</p></div></div><p>To illustrate the benefit of the log-volume normalization for the analysis of dose-response data, we may consider 2 peaks:</p><pre><code class="language-julia hljs">p_A(x) =  pdf(Normal(1e-6, 3e-7),x)
p_B(x) = pdf(Normal(1e-5,3e-6),x)
p(x) = p_A(x) + p_B(x)

plot(p, xaxis = :log, xlims = [1e-10,1e-2], fill = 0, label = &quot;density&quot;)</code></pre><img src="55600425.svg" alt="Example block output"/><p>As before, the density is approximated with a <code>OneDimGrid</code>:</p><pre><code class="language-julia hljs">grid = create_grid(LogRange(1e-10,1e-2,100))
approximate_density!(grid, p, volume_normalization = true)</code></pre><pre class="documenter-example-output"><code class="nohighlight hljs ansi">AdaptiveDensityApproximation.OneDimGrid{Dict{String, AdaptiveDensityApproximation.OneDimBlock}}(Dict{String, AdaptiveDensityApproximation.OneDimBlock}(&quot;rnsC3MkRte&quot; =&gt; AdaptiveDensityApproximation.OneDimBlock(&quot;rnsC3MkRte&quot;, AdaptiveDensityApproximation.Interval{Float64, Float64}(0.005722367659350226, 0.006892612104349702), [&quot;5siuet19Hw&quot;, &quot;glTueXAmFy&quot;], 0.0), &quot;kPSxdGsqa1&quot; =&gt; AdaptiveDensityApproximation.OneDimBlock(&quot;kPSxdGsqa1&quot;, AdaptiveDensityApproximation.Interval{Float64, Float64}(9.111627561154906e-7, 1.097498765493059e-6), [&quot;JZY8ZId8Wv&quot;, &quot;VYYi4Duv9H&quot;], 0.24804168930738268), &quot;glTueXAmFy&quot; =&gt; AdaptiveDensityApproximation.OneDimBlock(&quot;glTueXAmFy&quot;, AdaptiveDensityApproximation.Interval{Float64, Float64}(0.006892612104349702, 0.008302175681319761), [&quot;rnsC3MkRte&quot;, &quot;xudsMH1TLH&quot;], 0.0), &quot;MaYfOpfg2Z&quot; =&gt; AdaptiveDensityApproximation.OneDimBlock(&quot;MaYfOpfg2Z&quot;, AdaptiveDensityApproximation.Interval{Float64, Float64}(2.2051307399030457e-8, 2.656087782946684e-8), [&quot;cA9raUSoOP&quot;, &quot;Wg8ekan439&quot;], 3.265367148204749e-5), &quot;rkKuBl66H8&quot; =&gt; AdaptiveDensityApproximation.OneDimBlock(&quot;rkKuBl66H8&quot;, AdaptiveDensityApproximation.Interval{Float64, Float64}(0.001873817422860385, 0.002257019719633924), [&quot;ZAZ7Pts8wh&quot;, &quot;J6Gg13OWfD&quot;], 0.0), &quot;AshJumXJO8&quot; =&gt; AdaptiveDensityApproximation.OneDimBlock(&quot;AshJumXJO8&quot;, AdaptiveDensityApproximation.Interval{Float64, Float64}(2.0565123083486556e-7, 2.477076355991714e-7), [&quot;JSbwr9YnHH&quot;, &quot;hRBWX8VfDx&quot;], 0.0020448861647290395), &quot;KbzubtyHYL&quot; =&gt; AdaptiveDensityApproximation.OneDimBlock(&quot;KbzubtyHYL&quot;, AdaptiveDensityApproximation.Interval{Float64, Float64}(1.4508287784959432e-10, 1.747528400007683e-10), [&quot;tWlNIePp7n&quot;, &quot;1KJlAs0fw2&quot;], 1.6805827504843276e-7), &quot;lFy7xRAkRB&quot; =&gt; AdaptiveDensityApproximation.OneDimBlock(&quot;lFy7xRAkRB&quot;, AdaptiveDensityApproximation.Interval{Float64, Float64}(1.1768119524350015e-7, 1.4174741629268078e-7), [&quot;mrnlnHR2Zk&quot;, &quot;OfY4badgYG&quot;], 0.0004904763850947775), &quot;l2c5FlqUjG&quot; =&gt; AdaptiveDensityApproximation.OneDimBlock(&quot;l2c5FlqUjG&quot;, AdaptiveDensityApproximation.Interval{Float64, Float64}(3.8535285937105434e-8, 4.641588833612773e-8), [&quot;ZO0MxIdMuW&quot;, &quot;wLW8pIp6J6&quot;], 6.854714184871576e-5), &quot;5siuet19Hw&quot; =&gt; AdaptiveDensityApproximation.OneDimBlock(&quot;5siuet19Hw&quot;, AdaptiveDensityApproximation.Interval{Float64, Float64}(0.0047508101621027985, 0.005722367659350226), [&quot;5PVK6wZVE6&quot;, &quot;rnsC3MkRte&quot;], 0.0)…))</code></pre><p>Next, we compare the preferred (default) log-volume normalization with the standard volume normalization (which is true to the actual density). To identify the individual effect of the peaks, we approximate <code>p_A(x)</code> and <code>p_B(x)</code> individually:</p><pre><code class="language-julia hljs">grid_A = create_grid(LogRange(1e-10,1e-2,100))
approximate_density!(grid_A, p_A, volume_normalization = true)

grid_B = create_grid(LogRange(1e-10,1e-2,100))
approximate_density!(grid_B, p_B, volume_normalization = true)

lv_plot = plot(DensityPlot(grid_A), xaxis = :log, fill = 0, title = &quot;log-volume&quot;, label = &quot;peak A&quot;)
plot!(DensityPlot(grid_B), fill = 0, label = &quot;peak B&quot;)


v_plot = plot(DensityPlot(grid_A), xaxis = :log, volume_normalization = :linear, fill = 0, title = &quot;volume&quot;, label = &quot;peak A&quot;)
plot!(DensityPlot(grid_B), volume_normalization = :linear, fill = 0, label = &quot;peak B&quot;)

plot(lv_plot, v_plot, layout = (1,2), size = (800,300))</code></pre><img src="ba25f2ff.svg" alt="Example block output"/><p>With the log-volume normalization both peaks have the same size, suggesting that each peak has the same effect strength w.r.t. to the dose-response curve, albeit at different locations. With the standard volume normalization, however, peak A is significantly larger than peak B, indicating that peak B affects the dose-response curve only marginally. </p><p>Since we have approximated grids for each peak individually, as well as for the whole density, it can easily be checked how strong the effect of each peak is, by simulating the corresponding dose-response curves:</p><pre><code class="language-julia hljs">concentrations = LogRange(1e-10,1e-2, 100)

dr_A = DoseResponseResult(grid_A, concentrations)
dr_B = DoseResponseResult(grid_B, concentrations)
dr_total = DoseResponseResult(grid, concentrations)

plot(dr_A, label = &quot;peak A&quot;, xaxis = :log, legend = :topleft, linewidth = 3)
plot!(dr_B, label = &quot;peak B&quot;, linewidth = 3)
plot!(dr_total, label = &quot;both peaks&quot;, linewidth = 3)</code></pre><img src="3325379b.svg" alt="Example block output"/><p>As the log-volume normalized plot suggested, both peaks have the same effect strength w.r.t. to the dose-response curve. The only difference is the location of the effect.</p><div class="admonition is-category-remark"><header class="admonition-header">Visualization</header><div class="admonition-body"><p>While the standard volume normalization shows the true density, the log-volume normalization is more useful for the analysis of dose-response curves.</p></div></div></article><nav class="docs-footer"><a class="docs-footer-prevpage" href="../ResultsAndSimulations/">« Results and simulations</a><a class="docs-footer-nextpage" href="../Fitting/">Fitting »</a><div class="flexbox-break"></div><p class="footer-message">Powered by <a href="https://github.com/JuliaDocs/Documenter.jl">Documenter.jl</a> and the <a href="https://julialang.org/">Julia Programming Language</a>.</p></nav></div><div class="modal" id="documenter-settings"><div class="modal-background"></div><div class="modal-card"><header class="modal-card-head"><p class="modal-card-title">Settings</p><button class="delete"></button></header><section class="modal-card-body"><p><label class="label">Theme</label><div class="select"><select id="documenter-themepicker"><option value="auto">Automatic (OS)</option><option value="documenter-light">documenter-light</option><option value="documenter-dark">documenter-dark</option><option value="catppuccin-latte">catppuccin-latte</option><option value="catppuccin-frappe">catppuccin-frappe</option><option value="catppuccin-macchiato">catppuccin-macchiato</option><option value="catppuccin-mocha">catppuccin-mocha</option></select></div></p><hr/><p>This document was generated with <a href="https://github.com/JuliaDocs/Documenter.jl">Documenter.jl</a> version 1.5.0 on <span class="colophon-date" title="Thursday 25 July 2024 17:42">Thursday 25 July 2024</span>. Using Julia version 1.10.2.</p></section><footer class="modal-card-foot"></footer></div></div></div></body></html>
